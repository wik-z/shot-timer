(window["webpackJsonpshot-timer"]=window["webpackJsonpshot-timer"]||[]).push([[0],[,,,,,,,,,,,,function(e,t,n){e.exports=n(24)},,,,,function(e,t,n){},function(e,t,n){},,function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){"use strict";n.r(t);var a=n(0),i=n.n(a),r=n(11),o=n.n(r),c=(n(17),n(1)),l=n(2),s=n(4),u=n(3),h=n(5),d=(n(18),n(6)),v={STAGE_PRIVILEGES:"privileges",STAGE_CALIBRATION:"calibration",STAGE_TIMER:"timer"},m=Object(a.createContext)({stage:v.STAGE_PRIVILEGES,changeStage:function(e){}}),p=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(s.a)(this,Object(u.a)(t).call(this,e))).state={stage:v.STAGE_PRIVILEGES,changeStage:n.changeStage},n.state.changeStage=n.changeStage.bind(Object(d.a)(n)),n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"changeStage",value:function(e){this.setState({stage:e})}},{key:"render",value:function(){return i.a.createElement(m.Provider,{value:this.state},this.props.children)}}]),t}(i.a.Component);m.Controller=p;var g=m,f=n(9),b=n(7),E=n.n(b),k=n(8),y=new(function(){function e(){Object(c.a)(this,e),this.audioContext=null,this.inputDevice=null,this.listeners={},this.error=!1}return Object(l.a)(e,[{key:"emit",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.listeners[e]&&this.listeners[e].forEach(function(e){"function"===typeof e&&e(t)})}},{key:"on",value:function(e,t){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t)}},{key:"removeListener",value:function(e,t){if(this.listeners[e]){var n=this.listeners[e].findIndex(function(e){return e===t});-1!==n&&this.listeners[e].splice(n,1)}}},{key:"init",value:function(){if(this.audioContext=new AudioContext,navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,!navigator.getUserMedia)throw this.error=!0,new Error("UserMedia API not available!")}},{key:"getAvailableInputDevices",value:function(){return new Promise(function(e,t){navigator.mediaDevices.enumerateDevices().then(function(t){e(t.filter(function(e){return"audioinput"===e.kind}))}).catch(t)})}},{key:"selectDevice",value:function(e){this.inputDevice=e}},{key:"listen",value:function(){var e=this;return new Promise(function(t,n){e.inputDevice||n("No device selected!");var a={audio:{deviceId:e.inputDevice}};navigator.getUserMedia(a,function(n){e.initialiseMicrophoneServices(n),t()},function(e){n(e)})})}},{key:"initialiseMicrophoneServices",value:function(e){var t=this.audioContext.createMediaStreamSource(e),n=this.createAudioMeter(this.audioContext);t.connect(n)}},{key:"createAudioMeter",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.98,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.95,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:750,r=e.createScriptProcessor(512);return r.onaudioprocess=function(e){t.volumeAudioProcess(e,r),t.onAudioProcess(e,r)},r.clipping=!1,r.lastClip=0,r.volume=0,r.clipLevel=n,r.averaging=a,r.clipLag=i,r.connect(e.destination),r.checkClipping=function(){return!!this.clipping&&(this.lastClip+this.clipLag<window.performance.now()&&(this.clipping=!1),this.clipping)},r.shutdown=function(){this.disconnect(),this.onaudioprocess=null},r}},{key:"onAudioProcess",value:function(e,t){this.emit("audio-process",{event:e,processor:t})}},{key:"volumeAudioProcess",value:function(e,t){for(var n,a=e.inputBuffer.getChannelData(0),i=a.length,r=0,o=0;o<i;o++)n=a[o],Math.abs(n)>=t.clipLevel&&(t.clipping=!0,t.lastClip=window.performance.now()),r+=n*n;var c=Math.sqrt(r/i),l=Math.max(c,t.volume*t.averaging);if(t.volume!==l){t.volume=l;var s=Math.min(Math.round(100*l),100);s!==this.volume&&(this.volume=s,this.emit("volume-change",this.volume))}}}]),e}());n(20);var S=function(e){var t=e.volume,n=e.peak,a=e.threshold;return i.a.createElement("div",{className:"volume-display"},i.a.createElement("div",{className:"bar",style:{width:"".concat(t,"%")}}),n&&i.a.createElement("div",{className:"peak-indicator"}),a&&i.a.createElement("div",{className:"threshold-indicator",style:{width:"".concat(a,"%")}}))},C=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return(n=Object(s.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(i)))).state={availableDevices:[]},n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=Object(k.a)(E.a.mark(function e(){var t;return E.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y.getAvailableInputDevices();case 2:t=e.sent,this.setState({availableDevices:t});case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){return i.a.createElement("select",{value:this.props.value,onChange:this.props.onChange},i.a.createElement("option",{value:null},"Select..."),this.state.availableDevices.map(function(e,t){return i.a.createElement("option",{value:e.deviceId,key:e.deviceId},e.label||"Unknown device #".concat(t+1))}))}}]),t}(i.a.Component);n(21);var O,w=function(e){var t=e.children,n=e.id;return i.a.createElement("div",{className:"stage-wrapper",id:"stage-".concat(n)},t)},j=(n(22),function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(s.a)(this,Object(u.a)(t).call(this,e))).state={error:!1,goodToProceed:!1,clickedStart:!1,selectedDevice:"",volume:0},n.handleVolumeChange=n.handleVolumeChange.bind(Object(d.a)(n)),n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=Object(k.a)(E.a.mark(function e(){return E.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:y.error&&(console.error("MicrophoneService failed to load"),this.setState({error:!0}));case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"init",value:function(){var e=Object(k.a)(E.a.mark(function e(){var t;return E.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,y.init(),e.next=4,y.getAvailableInputDevices();case 4:if((t=e.sent)&&t.length){e.next=8;break}return console.log("No devices found!"),e.abrupt("return",this.setState({error:!0}));case 8:return y.selectDevice(this.state.selectedDevice),y.on("volume-change",this.handleVolumeChange),e.next=12,y.listen();case 12:this.setState({goodToProceed:!0}),e.next=19;break;case 15:e.prev=15,e.t0=e.catch(0),console.log(e.t0),this.setState({error:!0});case 19:case"end":return e.stop()}},e,this,[[0,15]])}));return function(){return e.apply(this,arguments)}}()},{key:"componentWillUnmount",value:function(){y.removeListener("volume-change",this.handleVolumeChange)}},{key:"handleVolumeChange",value:function(e){this.setState({volume:e})}},{key:"handleClickedStart",value:function(){this.setState({clickedStart:!0}),this.init()}},{key:"handleProceed",value:function(){this.props.changeStage(v.STAGE_CALIBRATION)}},{key:"handleDeviceChange",value:function(e){var t=e.target.value;this.setState({selectedDevice:t})}},{key:"render",value:function(){return i.a.createElement(w,{id:"privileges"},this.state.error?i.a.createElement("div",{className:"error"},i.a.createElement("p",null,"An error occured."),i.a.createElement("p",null,"Looks like your browser doesn't support our core features (or you didn't grant us access).")):i.a.createElement("div",null,this.state.goodToProceed?i.a.createElement("div",{className:"current-read"},i.a.createElement("h2",null,"Current microphone read:"),i.a.createElement(S,{volume:this.state.volume}),i.a.createElement("h4",null,"All good?"),i.a.createElement("p",null,"(If not, it might be worth reloading the page and picking a different device)"),i.a.createElement("button",{onClick:this.handleProceed.bind(this),className:"btn"},"PROCEED")):i.a.createElement("div",{className:"access-request"},this.state.clickedStart?i.a.createElement(i.a.Fragment,null,i.a.createElement("p",null,"Waiting for access to microphone...")):i.a.createElement(i.a.Fragment,null,i.a.createElement("h4",null,"We need access to your microphone ",i.a.createElement("i",null,"(duh...)")),this.state.selectedDevice?i.a.createElement(i.a.Fragment,null,i.a.createElement("p",null,"Now click the button below to start."),i.a.createElement("p",null,i.a.createElement("button",{onClick:this.handleClickedStart.bind(this),className:"btn"},"START"))):i.a.createElement(i.a.Fragment,null,i.a.createElement("p",null,"First, please select the microphone you'd like to use:"),i.a.createElement(C,{value:this.state.selectedDevice,onChange:this.handleDeviceChange.bind(this)}))))))}}]),t}(i.a.Component)),A=(n(23),{STANDBY:"standby",LISTENING:"listening"}),I=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(s.a)(this,Object(u.a)(t).call(this,e))).state={volume:y.volume,threshold:45,captureMode:A.STANDBY,recentCapturedSample:null},n.handleVolumeChange=n.handleVolumeChange.bind(Object(d.a)(n)),n.handleThresholdChange=n.handleThresholdChange.bind(Object(d.a)(n)),n.handleAudioProcess=n.handleAudioProcess.bind(Object(d.a)(n)),n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){this.initMicrophoneService()}},{key:"componentWillUnmount",value:function(){y.removeListener("volume-change",this.handleVolumeChange),y.removeListener("audio-process",this.handleAudioProcess)}},{key:"initMicrophoneService",value:function(){y.on("volume-change",this.handleVolumeChange),y.on("audio-process",this.handleAudioProcess)}},{key:"handleVolumeChange",value:function(e){this.setState({volume:e})}},{key:"handleAudioProcess",value:function(e){var t=e.event;e.processor;if(y.volume>=this.state.threshold){if(this.state.captureMode===A.STANDBY){var n=Array.from(t.inputBuffer.getChannelData(0));this.setState({captureMode:A.LISTENING,recentCapturedSample:n})}}else this.state.captureMode===A.LISTENING&&this.setState({captureMode:A.STANDBY})}},{key:"handleThresholdChange",value:function(e){this.setState({threshold:e.target.value})}},{key:"handleSubmit",value:function(){}},{key:"render",value:function(){return i.a.createElement(w,{id:"calibration"},i.a.createElement("h2",null,"Let's pick the right sound"),i.a.createElement("h3",null,"Before we start, we need to set threshold right"),i.a.createElement("p",null,"Try placing a few shots and adjusting the value below to make sure I pick up shots only."),i.a.createElement("p",null,"Also, for best results, keep your phone exactly where you'll have it during shooting."),i.a.createElement("div",{className:"threshold-regulation"},i.a.createElement("div",{className:"threshold-range-input"},i.a.createElement("input",{type:"range",min:"0",max:"100",step:"1",value:this.state.threshold,onChange:this.handleThresholdChange})),i.a.createElement(S,{volume:this.state.volume,threshold:this.state.threshold})),this.state.recentCapturedSample&&i.a.createElement(i.a.Fragment,null,i.a.createElement("p",null,"If it looks right, let's continue to the interesting part!"),i.a.createElement("button",{className:"btn",onClick:this.handleSubmit.bind(this)},"CONTINUE")))}}]),t}(i.a.Component),N=(O={},Object(f.a)(O,v.STAGE_CALIBRATION,I),Object(f.a)(O,v.STAGE_PRIVILEGES,j),O),D=function(e){function t(){return Object(c.a)(this,t),Object(s.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return i.a.createElement(g.Consumer,null,function(e){return i.a.createElement(N[e.stage],e)})}}]),t}(i.a.Component),M=function(e){function t(){return Object(c.a)(this,t),Object(s.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return i.a.createElement(g.Controller,null,i.a.createElement("div",{className:"App"},i.a.createElement("div",{id:"main"},i.a.createElement(D,null))))}}]),t}(i.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(i.a.createElement(M,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}],[[12,1,2]]]);
//# sourceMappingURL=main.a4c2143f.chunk.js.map