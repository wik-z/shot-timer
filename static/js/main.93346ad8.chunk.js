(window["webpackJsonpshot-timer"]=window["webpackJsonpshot-timer"]||[]).push([[0],[,,,,,,,,,,,,,function(e,t,n){e.exports=n(27)},,,,,function(e,t,n){},function(e,t,n){},,function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){"use strict";n.r(t);var a=n(0),i=n.n(a),r=n(11),o=n.n(r),s=(n(18),n(1)),l=n(2),c=n(6),u=n(4),h=n(5),d=(n(19),n(9)),m=n(3),v={STAGE_PRIVILEGES:"privileges",STAGE_CALIBRATION:"calibration",STAGE_TIMER:"timer"},p=Object(a.createContext)({stage:v.STAGE_PRIVILEGES,changeStage:function(e){},threshold:45,changeThreshold:function(e){}}),f=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(c.a)(this,Object(u.a)(t).call(this,e))).state={stage:v.STAGE_PRIVILEGES,changeStage:n.changeStage,threshold:45,changeThreshold:n.changeThreshold},n.state.changeStage=n.changeStage.bind(Object(m.a)(n)),n.state.changeThreshold=n.changeThreshold.bind(Object(m.a)(n)),n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"changeStage",value:function(e){this.setState({stage:e})}},{key:"changeThreshold",value:function(e){this.setState({threshold:e})}},{key:"render",value:function(){return i.a.createElement(p.Provider,{value:this.state},this.props.children)}}]),t}(i.a.Component);p.Controller=f;var g=p,E=n(7),b=n.n(E),S=n(8),y=new(function(){function e(){Object(s.a)(this,e),this.audioContext=null,this.inputDevice=null,this.listeners={},this.error=!1,this.volume=0}return Object(l.a)(e,[{key:"emit",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.listeners[e]&&this.listeners[e].forEach(function(e){"function"===typeof e&&e(t)})}},{key:"on",value:function(e,t){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t)}},{key:"removeListener",value:function(e,t){if(this.listeners[e]){var n=this.listeners[e].findIndex(function(e){return e===t});-1!==n&&this.listeners[e].splice(n,1)}}},{key:"init",value:function(){if(this.audioContext=new AudioContext,navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,!navigator.getUserMedia)throw this.error=!0,new Error("UserMedia API not available!")}},{key:"getAvailableInputDevices",value:function(){return new Promise(function(e,t){navigator.mediaDevices.enumerateDevices().then(function(t){e(t.filter(function(e){return"audioinput"===e.kind}))}).catch(t)})}},{key:"selectDevice",value:function(e){this.inputDevice=e}},{key:"listen",value:function(){var e=this;return new Promise(function(t,n){e.inputDevice||n("No device selected!");var a={audio:{deviceId:e.inputDevice}};navigator.getUserMedia(a,function(n){e.initialiseMicrophoneServices(n),t()},function(e){n(e)})})}},{key:"initialiseMicrophoneServices",value:function(e){var t=this.audioContext.createMediaStreamSource(e),n=this.createAudioMeter(this.audioContext);t.connect(n)}},{key:"createAudioMeter",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.98,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.95,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:750,r=e.createScriptProcessor(512);return r.onaudioprocess=function(e){t.volumeAudioProcess(e,r),t.onAudioProcess(e,r)},r.clipping=!1,r.lastClip=0,r.volume=0,r.clipLevel=n,r.averaging=a,r.clipLag=i,r.connect(e.destination),r.checkClipping=function(){return!!this.clipping&&(this.lastClip+this.clipLag<window.performance.now()&&(this.clipping=!1),this.clipping)},r.shutdown=function(){this.disconnect(),this.onaudioprocess=null},r}},{key:"onAudioProcess",value:function(e,t){this.emit("audio-process",{event:e,processor:t})}},{key:"volumeAudioProcess",value:function(e,t){for(var n,a=e.inputBuffer.getChannelData(0),i=a.length,r=0,o=0;o<i;o++)n=a[o],Math.abs(n)>=t.clipLevel&&(t.clipping=!0,t.lastClip=window.performance.now()),r+=n*n;var s=Math.sqrt(r/i),l=Math.max(s,t.volume*t.averaging);if(t.volume!==l){t.volume=l;var c=Math.min(Math.round(100*l),100);c!==this.volume&&(this.volume=c,this.emit("volume-change",this.volume))}}}]),e}());n(21);var k=function(e){var t=e.volume,n=e.peak,a=e.threshold;return i.a.createElement("div",{className:"volume-display"},i.a.createElement("div",{className:"bar",style:{width:"".concat(t,"%")}}),n&&i.a.createElement("div",{className:"peak-indicator"}),a&&i.a.createElement("div",{className:"threshold-indicator",style:{width:"".concat(a,"%")}}))},O=function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return(n=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(i)))).state={availableDevices:[]},n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=Object(S.a)(b.a.mark(function e(){var t;return b.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y.getAvailableInputDevices();case 2:t=e.sent,this.setState({availableDevices:t});case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){return i.a.createElement("select",{value:this.props.value,onChange:this.props.onChange},i.a.createElement("option",{value:null},"Select..."),this.state.availableDevices.map(function(e,t){return i.a.createElement("option",{value:e.deviceId,key:e.deviceId},e.label||"Unknown device #".concat(t+1))}))}}]),t}(i.a.Component);n(22);var C=function(e){var t=e.children,n=e.id;return i.a.createElement("div",{className:"stage-wrapper",id:"stage-".concat(n)},i.a.createElement("div",{className:"stage-inner"},t))},T=(n(23),function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(c.a)(this,Object(u.a)(t).call(this,e))).state={error:!1,goodToProceed:!1,clickedStart:!1,selectedDevice:"",volume:0},n.handleVolumeChange=n.handleVolumeChange.bind(Object(m.a)(n)),n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=Object(S.a)(b.a.mark(function e(){return b.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:y.error&&(console.error("MicrophoneService failed to load"),this.setState({error:!0}));case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"init",value:function(){var e=Object(S.a)(b.a.mark(function e(){var t;return b.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,y.init(),e.next=4,y.getAvailableInputDevices();case 4:if((t=e.sent)&&t.length){e.next=8;break}return console.log("No devices found!"),e.abrupt("return",this.setState({error:!0}));case 8:return y.selectDevice(this.state.selectedDevice),y.on("volume-change",this.handleVolumeChange),e.next=12,y.listen();case 12:this.setState({goodToProceed:!0}),e.next=19;break;case 15:e.prev=15,e.t0=e.catch(0),console.log(e.t0),this.setState({error:!0});case 19:case"end":return e.stop()}},e,this,[[0,15]])}));return function(){return e.apply(this,arguments)}}()},{key:"componentWillUnmount",value:function(){y.removeListener("volume-change",this.handleVolumeChange)}},{key:"handleVolumeChange",value:function(e){this.setState({volume:e})}},{key:"handleClickedStart",value:function(){this.setState({clickedStart:!0}),this.init()}},{key:"handleProceed",value:function(){this.props.changeStage(v.STAGE_CALIBRATION)}},{key:"handleDeviceChange",value:function(e){var t=e.target.value;this.setState({selectedDevice:t})}},{key:"render",value:function(){return i.a.createElement(C,{id:"privileges"},this.state.error?i.a.createElement("div",{className:"error"},i.a.createElement("p",null,"An error occured."),i.a.createElement("p",null,"Looks like your browser doesn't support our core features (or you didn't grant us access).")):i.a.createElement("div",null,this.state.goodToProceed?i.a.createElement("div",{className:"current-read"},i.a.createElement("h2",null,"Current microphone read:"),i.a.createElement(k,{volume:this.state.volume}),i.a.createElement("h4",null,"All good?"),i.a.createElement("p",null,"(If not, it might be worth reloading the page and picking a different device)"),i.a.createElement("button",{onClick:this.handleProceed.bind(this),className:"btn"},"PROCEED")):i.a.createElement("div",{className:"access-request"},this.state.clickedStart?i.a.createElement(i.a.Fragment,null,i.a.createElement("p",null,"Waiting for access to microphone...")):i.a.createElement(i.a.Fragment,null,i.a.createElement("h4",null,"We need access to your microphone ",i.a.createElement("i",null,"(duh...)")),this.state.selectedDevice?i.a.createElement(i.a.Fragment,null,i.a.createElement("p",null,"Now click the button below to start."),i.a.createElement("p",null,i.a.createElement("button",{onClick:this.handleClickedStart.bind(this),className:"btn"},"START"))):i.a.createElement(i.a.Fragment,null,i.a.createElement("p",null,"First, please select the microphone you'd like to use:"),i.a.createElement(O,{value:this.state.selectedDevice,onChange:this.handleDeviceChange.bind(this)}))))))}}]),t}(i.a.Component)),N=(n(24),{STANDBY:"standby",LISTENING:"listening"}),A=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(c.a)(this,Object(u.a)(t).call(this,e))).state={volume:y.volume,threshold:45,captureMode:N.STANDBY,recentCapturedSample:null},n.handleVolumeChange=n.handleVolumeChange.bind(Object(m.a)(n)),n.handleThresholdChange=n.handleThresholdChange.bind(Object(m.a)(n)),n.handleAudioProcess=n.handleAudioProcess.bind(Object(m.a)(n)),n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){this.initMicrophoneService()}},{key:"componentWillUnmount",value:function(){y.removeListener("volume-change",this.handleVolumeChange),y.removeListener("audio-process",this.handleAudioProcess)}},{key:"initMicrophoneService",value:function(){y.on("volume-change",this.handleVolumeChange),y.on("audio-process",this.handleAudioProcess)}},{key:"handleVolumeChange",value:function(e){this.setState({volume:e})}},{key:"handleAudioProcess",value:function(e){var t=e.event;e.processor;if(y.volume>=this.state.threshold){if(this.state.captureMode===N.STANDBY){var n=Array.from(t.inputBuffer.getChannelData(0));this.setState({captureMode:N.LISTENING,recentCapturedSample:n})}}else this.state.captureMode===N.LISTENING&&this.setState({captureMode:N.STANDBY})}},{key:"handleThresholdChange",value:function(e){this.setState({threshold:e.target.value})}},{key:"handleSubmit",value:function(){this.context.changeThreshold(this.state.threshold),this.context.changeStage(v.STAGE_TIMER)}},{key:"render",value:function(){return i.a.createElement(C,{id:"calibration"},i.a.createElement("h2",null,"Let's pick the right sound"),i.a.createElement("h3",null,"Before we start, we need to set threshold right"),i.a.createElement("p",null,"Try placing a few shots and adjusting the value below to make sure I pick up shots only."),i.a.createElement("p",null,"Also, for best results, keep your phone exactly where you'll have it during shooting."),i.a.createElement("div",{className:"threshold-regulation"},i.a.createElement("div",{className:"threshold-range-input"},i.a.createElement("input",{type:"range",min:"0",max:"100",step:"1",value:this.state.threshold,onChange:this.handleThresholdChange})),i.a.createElement(k,{volume:this.state.volume,threshold:this.state.threshold})),this.state.recentCapturedSample&&i.a.createElement(i.a.Fragment,null,i.a.createElement("p",null,"If it looks right, let's continue to the interesting part!"),i.a.createElement("button",{className:"btn",onClick:this.handleSubmit.bind(this)},"CONTINUE")))}}]),t}(i.a.Component);A.contextType=g;var j=A,w=n(12);n(25),n(26);var D=function(e){var t=e.value;return i.a.createElement("div",{className:"timer-display"},i.a.createElement("span",null,t?function(e){var t=e/1e3,n=1e3*parseFloat((t-Math.floor(t)).toFixed(2)),a=Math.floor(t);return String(a).padStart(2,"0")+":"+String(n).substr(0,2)}(t):"--:--"))};var I=function(e){var t=e.mode,n=e.modes,a=e.onStartButtonClick,r=e.onStopButtonClick;return i.a.createElement("div",{className:"timer-buttons"},t===n.OFF&&i.a.createElement("button",{onClick:a},"START"),t===n.STANDBY&&i.a.createElement("button",{disabled:!0},"STANDBY"),t===n.ON&&i.a.createElement("button",{onClick:r},"STOP"))},B=function(){function e(){Object(s.a)(this,e),this.audioContext=null,this.oscillator=null,this.state=e.states.BEEPER_STANDBY,this.frequency=3e3,this.duration=200,this.audioContext=new AudioContext,this.prepareOscillator()}return Object(l.a)(e,[{key:"prepareOscillator",value:function(){this.oscillator=this.audioContext.createOscillator(),this.oscillator.type="square",this.oscillator.frequency.value=this.frequency,this.oscillator.connect(this.audioContext.destination)}},{key:"play",value:function(){var t=this;return new Promise(function(n,a){t.state===e.states.BEEPER_PLAYING&&a("Beeper is already playing"),t.oscillator.start(),t.state=e.states.BEEPER_PLAYING,setTimeout(function(){t.oscillator.stop(),n(),t.state=e.states.BEEPER_STANDBY,t.prepareOscillator()},t.duration)})}}]),e}();B.states={BEEPER_STANDBY:"standby",BEEPER_PLAYING:"playing"};var M=B;var P=function(e){var t=e.startTimestamp,n=e.shots;return t&&0!==n.length?i.a.createElement("div",{className:"timer-shots-list"},i.a.createElement("ul",null,n.map(function(e){return i.a.createElement("li",null,e-t)}))):null},x={OFF:"off",STANDBY:"standby",ON:"on"},L={STANDBY:"standby",LISTENING:"listening"},G=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(c.a)(this,Object(u.a)(t).call(this,e))).state={mode:x.OFF,captureMode:L.STANDBY,shots:[]},n.beeper=new M,n.handleStartButton=n.handleStartButton.bind(Object(m.a)(n)),n.handleStopButton=n.handleStopButton.bind(Object(m.a)(n)),n.startExcercise=n.startExcercise.bind(Object(m.a)(n)),n.handleVolumeChange=n.handleVolumeChange.bind(Object(m.a)(n)),n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){this.initMicrophoneService()}},{key:"componentWillUnmount",value:function(){y.removeListener("volume-change",this.handleVolumeChange)}},{key:"initMicrophoneService",value:function(){y.on("volume-change",this.handleVolumeChange)}},{key:"handleVolumeChange",value:function(e){this.state.mode===x.ON&&(e<this.context.threshold?this.state.captureMode===L.LISTENING&&this.setState({captureMode:L.STANDBY}):this.state.captureMode===L.STANDBY&&this.setState({captureMode:L.LISTENING,shots:[].concat(Object(w.a)(this.state.shots),[(new Date).getTime()])}))}},{key:"handleStartButton",value:function(){this.setState({mode:x.STANDBY,shots:[]}),setTimeout(this.startExcercise,2e3)}},{key:"startExcercise",value:function(){var e=this;this.beeper.play(),setTimeout(function(){e.setState({mode:x.ON,startTimestamp:(new Date).getTime()-(e.beeper.duration+50)})},this.beeper.duration+50)}},{key:"handleStopButton",value:function(){this.setState({mode:x.OFF})}},{key:"getLastShotDelta",value:function(){var e=this.state,t=e.shots,n=e.startTimestamp;return 0!==t.length&&n?t[t.length-1]-n:null}},{key:"render",value:function(){return i.a.createElement(C,{id:"timer"},i.a.createElement(D,{value:this.getLastShotDelta()}),i.a.createElement(P,{startTimestamp:this.state.startTimestamp,shots:this.state.shots}),i.a.createElement(I,{modes:x,mode:this.state.mode,onStartButtonClick:this.handleStartButton,onStopButtonClick:this.handleStopButton}))}}]),t}(i.a.Component);G.contextType=g;var R,V=G,Y=(R={},Object(d.a)(R,v.STAGE_CALIBRATION,j),Object(d.a)(R,v.STAGE_PRIVILEGES,T),Object(d.a)(R,v.STAGE_TIMER,V),R),F=function(e){function t(){return Object(s.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return i.a.createElement(g.Consumer,null,function(e){return i.a.createElement(Y[e.stage],e)})}}]),t}(i.a.Component),_=function(e){function t(){return Object(s.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return i.a.createElement(g.Controller,null,i.a.createElement("div",{className:"App"},i.a.createElement("div",{id:"main"},i.a.createElement(F,null))))}}]),t}(i.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(i.a.createElement(_,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}],[[13,1,2]]]);
//# sourceMappingURL=main.93346ad8.chunk.js.map